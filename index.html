<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>co_ecs: co_ecs</title>
  <!--BEGIN PROJECT_ICON-->
  <link rel="icon" href="$projecticon" type="image/x-icon" />
  <!--END PROJECT_ICON-->
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <!--BEGIN COPY_CLIPBOARD-->
  <script type="text/javascript" src="clipboard.js"></script>
  <!--END COPY_CLIPBOARD-->
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  $darkmode
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeInteractiveToc.init()
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">co_ecs<span
                    id="projectnumber">&#160;0.9.0</span>
                </div>
                <div id="projectbrief">Cobalt ECS</div>
              </td>
            </tr>
            <!--BEGIN FULL_SIDEBAR-->
            <tr>
              <td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
            </tr>
            <!--END FULL_SIDEBAR-->
          </tbody>
        </table>
      </div>
      <!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceco__ecs.html">co_ecs</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_co_ecs_co_ecs_README"></a> <img src="https://img.shields.io/badge/STD-C++20-blue" alt="C++" class="inline"/> <a href="https://blyschak.github.io/co_ecs/"><img src="https://img.shields.io/badge/Documentation-Doxygen-blue" alt="Doxygen" class="inline"/></a> <a href="http://unlicense.org/"><img src="https://img.shields.io/badge/license-Unlicense-blue.svg" alt="License: Unlicense" style="pointer-events: none;" class="inline"/></a> <img src="https://github.com/Blyschak/co_ecs/actions/workflows/build.yml/badge.svg" alt="Build badge" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/Blyschak/cobalt-ecs"><img src="https://codecov.io/gh/Blyschak/co_ecs/branch/main/graph/badge.svg?token=BZ8Z6TXN55" alt="codecov" style="pointer-events: none;" class="inline"/></a> <img src="https://raw.githubusercontent.com/Blyschak/co_ecs/badges/badge.svg" alt="LoC" style="pointer-events: none;" class="inline"/></p>
<p><a class="el" href="namespaceco__ecs.html">co_ecs</a> is a header-only library implementing an Entity Component System.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
API Documentation</h1>
<p><a href="https://blyschak.github.io/co_ecs/">Doxygen</a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Build</h1>
<p>Compilation requires compiler with C++ 20 support.</p>
<p>Tested compilers:</p><ul>
<li>GCC 11.2</li>
<li>Clang 16</li>
<li>MSVC 14.32</li>
</ul>
<p>Before building targets create a <code>build/</code> directory in the root of the source tree and <code>cd</code> into it:</p>
<div class="fragment"><div class="line">mkdir build/ &amp;&amp; cd build/</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Build and run tests</h2>
<div class="fragment"><div class="line">cmake .. -DCO_ECS_ENABLE_TESTING=ON</div>
<div class="line">make -j$(nproc)</div>
<div class="line">make test</div>
</div><!-- fragment --><p>Generate coverage report:</p>
<div class="fragment"><div class="line">cmake .. -DCO_ECS_ENABLE_TESTING=ON -DCO_ECS_CODE_COVERAGE=ON</div>
<div class="line">make -j$(nproc)</div>
<div class="line">make test</div>
</div><!-- fragment --><p>Coverage reports might be misleading when building in release mode, so make sure you build in debug mode or explicitly pass <code>-DCMAKE_BUILD_TYPE=Debug</code>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Build and run benchmarks</h2>
<div class="fragment"><div class="line"># Build with optimizations</div>
<div class="line">cmake .. -DCO_ECS_ENABLE_BENCHMARKS=ON -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">make -j$(nproc)</div>
<div class="line">benchmarks/benchmarks</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Build documentation</h2>
<div class="fragment"><div class="line">cmake .. -DCO_ECS_ENABLE_DOCS=ON</div>
<div class="line">make docs</div>
<div class="line"># documentation generated: docs/html/index.html</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Build examples</h2>
<div class="fragment"><div class="line">cmake .. -DCO_ECS_ENABLE_EXAMPLES=ON</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
System wide installation</h2>
<p>Inside your build directory execute the following to install <code><a class="el" href="namespaceco__ecs.html">co_ecs</a></code>:</p>
<div class="fragment"><div class="line">make install</div>
</div><!-- fragment --><p>This <code>make</code> target will install <code><a class="el" href="namespaceco__ecs.html">co_ecs</a></code> headers into your system include directory.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
CMake Integration</h2>
<p>Using <code>FetchConent</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  co_ecs</div>
<div class="line">  GIT_REPOSITORY https://github.com/Blyschak/co_ecs</div>
<div class="line">  GIT_TAG main)</div>
<div class="line">FetchContent_MakeAvailable(co_ecs)</div>
<div class="line"> </div>
<div class="line"># link to your executable</div>
<div class="line">target_link_libraries(my-engine co_ecs)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Code example</h2>
<p><a href="examples/hello-registry/main.cpp">Example</a></p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &lt;co_ecs/co_ecs.hpp&gt;</div>
<div class="line"> </div>
<div class="line">#include &lt;iostream&gt;</div>
<div class="line"> </div>
<div class="line">struct position {</div>
<div class="line">    float x, y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct velocity {</div>
<div class="line">    float x, y;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void print_positions(const co_ecs::registry&amp; registry) {</div>
<div class="line">    registry.each(</div>
<div class="line">        [](const position&amp; position) { std::cout &lt;&lt; &quot;position {&quot; &lt;&lt; position.x &lt;&lt; &quot;, &quot; &lt;&lt; position.y &lt;&lt; &quot;}\n&quot;; });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int main() {</div>
<div class="line">    co_ecs::registry registry;</div>
<div class="line"> </div>
<div class="line">    for (int i = 0; i &lt; 100; i++) {</div>
<div class="line">        registry.create&lt;position, velocity&gt;({ i * 1.f, i * 1.5f }, { i * .3f, -i * 5.f });</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    for (auto [position, velocity] : registry.view&lt;position&amp;, const velocity&amp;&gt;().each()) {</div>
<div class="line">        position.x += velocity.x;</div>
<div class="line">        position.y += velocity.y;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    print_positions(registry);</div>
<div class="line"> </div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Components</h1>
<p>Component is any C++ type that satisfies the following:</p><ul>
<li>It is a non-union class type, meaning any <code>struct</code> or <code>class</code></li>
<li>It is <code>noexcept</code> move constructible</li>
<li>It is <code>noexcept</code> move assignable</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Views</h1>
<p>Views are used to iterate over entities in the registry which have a given set of components attached:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">for (auto [position, velocity] : registry.view&lt;position&amp;, const velocity&amp;&gt;().each()) {</div>
<div class="line">    // ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note, you don't have to worry about caching a view object returned by a <code>registry::view()</code> as it is very cheap to create, only when start iterating over it using <code>view::each()</code> an actual work on matching archetypes is done.</p>
<p>There's another way to iterate over interesting entities by using <code>registry::each()</code> which takes in an invocable as a parameter accepting component reference types:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">registry.each([](position&amp; pos, const velocity&amp; vel){</div>
<div class="line">    // ...</div>
<div class="line">});</div>
</div><!-- fragment --><p>Note that this kind of iteration might be even faster and better optimized by the compiler since the func can operate on a chunk that yields two tuples of pointers to the actual data whereas an each() variant returns an iterator over iterator over iterator to the actual data which is a challenge for compiler to optimize. Look at the benchmarks to see the actual difference. Looking forward for compilers to be better at optimizing <code>&lt;ranges&gt;</code> machinery for the above two variants to match in performance.</p>
<div class="fragment"><div class="line"> {co_ecs```}</div>
<div class="line"> </div>
<div class="line">```c++</div>
<div class="line">void foo(const co_ecs::registry&amp; registry) {</div>
<div class="line">    registry.view&lt;const position&amp;, const velocity&amp;&gt;(); // OK</div>
<div class="line">    registry.view&lt;position&amp;, const velocity&amp;&gt;();       // Error</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
Safety</h1>
<div class="fragment"><div class="line"> {co_ecs```}</div>
<div class="line"> </div>
<div class="line">```c++</div>
<div class="line">registry.create&lt;position, position&gt;({ 1, 2 }, { 3, 4 });</div>
</div><!-- fragment --><p>compiler will generate a static assertion error:</p>
<div class="fragment"><div class="line">Types must be unique within parameter pack</div>
</div><!-- fragment --><p>Another example is when trying to assign a component of type <code><a class="el" href="namespaceco__ecs.html#a2da96f6ca4426a42b949e7803a4627a6" title="Represents an entity, consisting of an ID and generation.">co_ecs::entity</a></code> by mistake. The <code><a class="el" href="namespaceco__ecs.html#a2da96f6ca4426a42b949e7803a4627a6" title="Represents an entity, consisting of an ID and generation.">co_ecs::entity</a></code> structure is handled the same way components are internally. It would be invalid to assign it as a component to an entity, so when attempting to do the following:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">registry.create&lt;co_ecs::entity, position&gt;({}, { 3, 4 });</div>
</div><!-- fragment --><p>compiler will raise the following static assertion error:</p>
<div class="fragment"><div class="line">Cannot give a mutable pointer/reference to the entity</div>
</div><!-- fragment --><p>implying that you cannot have a write access into chunk's memory where <code><a class="el" href="namespaceco__ecs.html#a2da96f6ca4426a42b949e7803a4627a6" title="Represents an entity, consisting of an ID and generation.">co_ecs::entity</a></code> objects are stored.</p>
<p>The same error message appears when trying to create a <code><a class="el" href="classco__ecs_1_1view.html" title="A view lets you get a range over components of Args out of a registry.">co_ecs::view</a></code> with read-write access to <code><a class="el" href="namespaceco__ecs.html#a2da96f6ca4426a42b949e7803a4627a6" title="Represents an entity, consisting of an ID and generation.">co_ecs::entity</a></code>:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">auto view = registry.view&lt;co_ecs::entity&amp;, position&amp;&gt;(); // Error</div>
</div><!-- fragment --><p>On the other hand, trying to query for <code>const <a class="el" href="namespaceco__ecs.html#a2da96f6ca4426a42b949e7803a4627a6" title="Represents an entity, consisting of an ID and generation.">co_ecs::entity</a>&amp;</code> is valid and the right method to fetch entity IDs together with it's components in the view:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">auto view = registry.view&lt;const co_ecs::entity&amp;, position&amp;&gt;(); // Ok</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
Pitfalls</h1>
<p>Components are referenced internally with IDs. The component ID is generated statically and the resulting ID is compiler implementation-defined. There should be no logic which expects a concrete ID value. Given how the ID generation works there's one limitation that restricts placing components inside implementation files (<code>*.cpp</code>) or private headers.</p>
<p>Consider the following two components with the same name defined in two separate compilation units in a global namespace:</p>
<p><em>foo.cpp</em>:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">struct my_component {</div>
<div class="line">    int value;</div>
<div class="line">};</div>
</div><!-- fragment --><p><em>bar.cpp</em>:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">struct my_component {</div>
<div class="line">    void* data;</div>
<div class="line">};</div>
</div><!-- fragment --><p>There is a high chance the compiler will generate the same ID for two different structures which will lead to undefined behavior. Thus, it is recommended to place all components in public header files or even in a single header file to avoid name collisions.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Exception safety</h1>
<p>TBD</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Usage across binary boundaries</h1>
<div class="fragment"><div class="line"> {co_ecs```}</div>
<div class="line">The core shared library should be compiled with ```CO_ECS_HOST``` defined and others must define ```CO_ECS_CLIENT```:</div>
<div class="line"> </div>
<div class="line">*engine.h*:</div>
<div class="line">```c++</div>
<div class="line">#include &lt;co_ecs/co_ecs.hpp&gt;</div>
<div class="line"> </div>
<div class="line">struct transform {</div>
<div class="line">    float translation[3];</div>
<div class="line">    float rotation[3];</div>
<div class="line">    float scale[3];</div>
<div class="line">};</div>
</div><!-- fragment --><p><em>engine.cpp</em>: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">#define CO_ECS_HOST</div>
<div class="line"> </div>
<div class="line">#include &quot;engine.h&quot;</div>
</div><!-- fragment --><p><em>client.cpp</em>: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">#define CO_ECS_CLIENT</div>
<div class="line"> </div>
<div class="line">#include &quot;engine.h&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md17"></a>
Performance</h1>
<p>TBD </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
